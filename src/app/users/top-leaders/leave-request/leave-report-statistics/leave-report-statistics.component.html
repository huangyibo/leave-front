<div>
  <div id="leave-detail" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 60%;" role="document">
      <div class="modal-content">
        <div class="modal-header" style="background: #3c8dbc">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white">
            <span style="color: white" aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" style="color: white">请假信息详情</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-5 col-md-offset-1">
              <div class="row">
                <form class="form-horizontal" role="form">
                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      姓名
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        {{editingLeaveRequest.user_name}}
                      </p>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      职务职称
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        {{editingLeaveRequest.major}}
                      </p>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      所属部门
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        {{editingLeaveRequest.department_name}}
                      </p>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      请假时间
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        {{editingLeaveRequest.start_date}} 至 {{editingLeaveRequest.end_date}}
                      </p>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      地点
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        <span *ngIf="editingLeaveRequest.origin_addr">{{editingLeaveRequest.origin_addr}}-></span>
                        <span *ngIf="editingLeaveRequest.middle_addr">{{editingLeaveRequest.middle_addr}}-></span>
                        <span *ngIf="editingLeaveRequest.dest_addr">{{editingLeaveRequest.dest_addr}}</span>
                      </p>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      通讯联系
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        {{!editingLeaveRequest.phone? '无': editingLeaveRequest.phone}}
                      </p>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-4 col-lg-4 control-label">
                      交通工具
                    </label>
                    <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                      <p class="form-control-static ">
                        {{!editingLeaveRequest.traffic_tool? '无' : editingLeaveRequest.traffic_tool}}
                      </p>
                    </div>
                  </div>

                </form>
              </div>
            </div>
            <div class="col-md-5 " style="border-left: #d2d6de solid 2px;padding-left: 2%">
              <form class="form-horizontal" role="form">

                <div class="form-group">
                  <label class="col-md-4 col-lg-4 control-label">
                    经费来源
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static ">
                      {{!editingLeaveRequest.funds_source? '无':editingLeaveRequest.funds_source}}
                    </p>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-4 col-lg-4 control-label">
                    授课任务
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static ">
                      {{!editingLeaveRequest.teaching? '无':'有'}}
                    </p>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-4 col-lg-4 control-label">
                    保密电脑
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static ">
                      {{!editingLeaveRequest.pc? '未携带':'携带'}}
                    </p>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-md-4 col-lg-4 control-label">
                    请假事由
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static " style="word-wrap:break-word; word-break:normal;">
                      {{!editingLeaveRequest.reason? '无':editingLeaveRequest.reason}}
                    </p>
                  </div>
                </div>

                <div class="form-group" [ngClass]="{'hidden': editingLeaveRequest.category=='LEADER'}">
                  <label class="col-md-4 col-lg-4 control-label">
                    科室审核
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static no-new-line">
                      <span *ngIf="editingLeaveRequest.leader_agree==null" class="label label-warning">待审核</span>
                      <span *ngIf="!(editingLeaveRequest.leader_agree == null)">{{editingLeaveRequest.leader_name}}--
                        <span *ngIf="editingLeaveRequest.leader_agree" class="label label-success">通过</span>
                        <span *ngIf="!editingLeaveRequest.leader_agree" class="label label-danger">未通过</span>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group has-feedback" [ngClass]="{'hidden': editingLeaveRequest.category=='LEADER'}">
                  <label class="col-xs-4 col-sm-4 col-md-4 col-lg-4 control-label">
                    科室意见
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static ">
                      {{!editingLeaveRequest.leader_comment? '无':editingLeaveRequest.leader_comment}}
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-4 col-lg-4 control-label">
                    系首长审核
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static no-new-line">
                      <span *ngIf="(editingLeaveRequest.category=='OFFICER' && (editingLeaveRequest.leader_agree == null
                      || (editingLeaveRequest.leader_agree && editingLeaveRequest.top_leader_agree==null))) || (editingLeaveRequest.category=='LEADER' && editingLeaveRequest.top_leader_agree==null)" class="label label-warning">待审核</span>
                      <span *ngIf="!(editingLeaveRequest.top_leader_agree == null)">{{editingLeaveRequest.top_leader_name}}--
                           <span *ngIf="editingLeaveRequest.top_leader_agree"
                                 class="label label-success">通过</span>
                           <span *ngIf="!editingLeaveRequest.top_leader_agree"
                                 class="label label-danger">未通过</span>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group has-feedback">
                  <label class="col-xs-4 col-sm-4 col-md-4 col-lg-4 control-label">
                    请假批注
                  </label>
                  <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                    <p class="form-control-static ">
                      {{!editingLeaveRequest.top_leader_comment? '无':editingLeaveRequest.top_leader_comment}}
                    </p>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" title="关闭窗口" data-dismiss="modal">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</div>

<div>
  <div id="leave-filter" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 50%;" role="document">
      <div class="modal-content">
        <div class="modal-header" style="background: #3c8dbc">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white">
            <span style="color: white" aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" style="color: white">筛选</h4>
        </div>
        <div class="modal-body">
          <div class="form-horizontal" role="form">

            <div class="form-group">
              <label for="selectDepartment" class="col-md-3 control-label">
                科室部门:
              </label>
              <div class="col-md-7">
                <select class="form-control" name="departments" [(ngModel)]="leaveRequestFilter.department_id" id="selectDepartment" data-placeholder="请选择科室部门" required>
                  <option *ngFor="let department of departments"  [value]="department.id">{{department.name}}</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="user_type" class="col-md-3 control-label">
                人员类型:
              </label>
              <div class="col-md-7">
                <select class="form-control" name="user_type" [(ngModel)]="leaveRequestFilter.category" id="user_type" data-placeholder="请选择请假人员类型" required>
                  <option *ngFor="let userType of userTypes" [value]="userType.value">{{userType.name}}</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="review_status" class="col-md-3 control-label">
                审核状态:
              </label>
              <div class="col-md-7">
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" id="review_status" name="review_status" [(ngModel)]="leaveRequestFilter.review_status" #review_status="ngModel" [value]="null"
                         required/>全部
                </label>
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" name="review_status" [(ngModel)]="leaveRequestFilter.review_status" #review_status="ngModel" [value]="true"
                         required/>已通过
                </label>
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" name="review_status" [(ngModel)]="leaveRequestFilter.review_status" #review_status="ngModel"
                         [value]="false" required/>未通过
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="sign_status" class="col-md-3 control-label">
                签到状态:
              </label>
              <div class="col-md-7">
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" id="sign_status" name="sign_status" [(ngModel)]="leaveRequestFilter.sign_status" #sign_status="ngModel" [value]="null"
                         required/>全部
                </label>
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" name="sign_status" [(ngModel)]="leaveRequestFilter.sign_status" #sign_status="ngModel" [value]="true"
                         required/>已签到
                </label>
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" name="sign_status" [(ngModel)]="leaveRequestFilter.sign_status" #sign_status="ngModel"
                         [value]="false" required/>未签到
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="fake_status" class="col-md-3 control-label">
                销假状态:
              </label>
              <div class="col-md-7">
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" id="fake_status" name="fake_status" [(ngModel)]="leaveRequestFilter.fake_status" #fake_status="ngModel" [value]="null"
                         required/>全部
                </label>
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" name="fake_status" [(ngModel)]="leaveRequestFilter.fake_status" #fake_status="ngModel" [value]="true"
                         required/>已销假
                </label>
                <label class="radio-inline" style="font-size: 16px">
                  <input type="radio" name="fake_status" [(ngModel)]="leaveRequestFilter.fake_status" #fake_status="ngModel"
                         [value]="false" required/>未销假
                </label>
              </div>
            </div>


            <div class="form-group">
              <label for="applyStartDate" class="col-md-3 control-label">
                申请日期区间:
              </label>
              <div class="col-md-7">
                <div class="row">
                  <div class="col-md-6">
                    <input type="date" class="form-control " [(ngModel)]="leaveRequestFilter.apply_time_range_start" name="apply_start_date" id="applyStartDate" placeholder="年-月-日"
                           required/>
                  </div>

                  <div class="col-md-6">
                    <input type="date" class="form-control " [(ngModel)]="leaveRequestFilter.apply_time_range_end" name="apply_end_date" placeholder="年-月-日" required/>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="leaveStartDate" class="col-md-3 control-label">
                请假日期区间:
              </label>
              <div class="col-md-7">
                <div class="row">
                  <div class="col-md-6">
                    <input type="date" class="form-control datepicker-inline" [(ngModel)]="leaveRequestFilter.leave_start_date" name="leave_start_date" id="leaveStartDate" placeholder="年-月-日"
                           required/>
                  </div>

                  <div class="col-md-6">
                    <input type="date" class="form-control " [(ngModel)]="leaveRequestFilter.leave_end_date" name="leave_end_date" placeholder="年-月-日" required/>
                  </div>
                </div>
              </div>
            </div>

            <!--<div class="form-group">
              <div class='input-group date' id='datetimepicker1'>
                <input type='text' class="form-control" />
                <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
              </div>
            </div>-->

          </div>
        </div>
        <div class="modal-footer">
          <button (click)="filterLeave()" type="button" class="btn btn-primary" title="确定">确定</button>
          <button type="button" class="btn btn-default" title="取消" data-dismiss="modal">取消</button>
          <button (click)="resetLeaveFilter()" type="button" class="btn btn-default" title="清空">清空</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</div>

<loading-animate></loading-animate>

<toaster-container [toasterconfig]="toasterconfig"></toaster-container>

<div class="container" style="width: 110%">
  <div class="row" style="margin-bottom: 20px;">
    <!--<div class="col-md-4">
      <nav aria-label="Page navigation">
        <ul class="pagination" style="margin-top: 0;padding-top: 0;">
          <li class="disabled">
            <a href="#" aria-label="Previous">
              <span aria-hidden="true">上一页</span>
            </a>
          </li>
          <li class="active"><a href="#">1</a></li>
          <li><a href="#">2</a></li>
          <li><a href="#">3</a></li>
          <li><a href="#">4</a></li>
          <li><a href="#">5</a></li>
          <li>
            <a href="#" aria-label="Next">
              <span aria-hidden="true">下一页</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>-->
    <div class="col-md-3 col-md-offset-4 text-center" style="padding-left: 0px;padding-top: 5px;">
      <span style="font-size: 15px">共&nbsp;{{rowCount}}&nbsp;条记录</span>
    </div>
    <div class="col-md-5 text-center">
      <form class="form-inline">
        <div class="form-group">
          <a class="btn btn-default" role="button" data-toggle="modal" data-target="#leave-filter">
            <span class="fa fa-filter">&nbsp;&nbsp;筛选</span>
          </a>
        </div>
        <div class="form-group"  style="margin-right: 12%;">
          <div class="input-group">
            <input [(ngModel)]="leaveRequestFilter.user_name" name="userName" type="text" class="form-control" style="border-color: #3c8dbc;" placeholder="输入姓名检索" />
            <a (click)="searchByRealName()" role="button" class="input-group-addon btn btn-default">
              <span class="fa fa-search"></span>
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="row">
    <div
      class="col-md-11 col-md-offset-0 table-responsive">
      <table class="table table-striped table-hover">
        <thead>
        <tr>
          <th>编号</th>
          <th>请假人</th>
          <th>申请时间</th>
          <th>请假时间</th>
          <th>请假事由</th>
          <th>审核状态</th>
          <th>签到状态</th>
          <th>销假状态</th>
          <th>操作</th>
        </tr>
        </thead>

        <tbody *ngIf="leaveRequests">

        <tr
          *ngFor="let leave of leaveRequests | async | paginate: {id: 'server', itemsPerPage: 10, currentPage: currentPage, totalItems: rowCount }">

          <td>
            <a (click)="editLeave(leave.id)" title="查看请假详情" role="button" data-toggle="modal" data-target="#leave-detail">{{leave.id}}</a>
          </td>

          <td>
            <a href="#">{{leave.user_name}}</a>
          </td>
          <td>
            {{leave.apply_time}}
          </td>
          <td>
            {{leave.start_date}} 至 {{leave.end_date}}
          </td>
          <td>
            <div class="text-wrap" title="{{leave.reason}}">{{leave.reason}}</div>
          </td>
          <td>
            <label class="label label-success" *ngIf="leave.top_leader_agree">通过</label>
            <label class="label label-warning" *ngIf="(leave.category=='OFFICER' && (leave.leader_agree == null || (leave.leader_agree && leave.top_leader_agree==null))) || (leave.category=='LEADER' && leave.top_leader_agree==null)">待审核</label>
            <label class="label label-danger" *ngIf="leave.top_leader_agree==false || leave.leader_agree==false">未通过</label>
          </td>
          <td>
            <label class="label label-success" *ngIf="leave.signed_status">已签到</label>
            <label class="label label-warning" *ngIf="leave.top_leader_agree && !leave.signed_status">未签到</label>
          </td>
          <td>
            <label class="label label-success" *ngIf="leave.fake_status">已销假</label>
            <label class="label label-warning" *ngIf="leave.top_leader_agree && !leave.fake_status">未销假</label>
          </td>
          <td class="no-new-line">
            <a (click)="editLeave(leave.id)" role="button" class="fa fa-edit" title="查看请假详情" data-toggle="modal" data-target="#leave-detail"></a>
          </td>
        </tr>


        </tbody>
      </table>
    </div>
    <div class="col-md-11 col-md-offset-0 table-responsive">
      <div class="col-md-6 col-md-offset-3 text-center">
        <div class="has-text-centered">
          <div class="spinner" [ngClass]="{ 'hidden': !isLoading }"></div>
          <pagination-controls (pageChange)="getPage($event, leaveRequestFilter)" id="server"></pagination-controls>
        </div>
      </div>
    </div>
  </div>
</div>
